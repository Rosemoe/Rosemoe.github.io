<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Text Warriorä¸­ä¸€äº›ä¸è¶³ä¹‹å¤„ | Rosemoeçš„å°åšå®¢</title><meta name="author" content="Rosemoe"><meta name="copyright" content="Rosemoe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="å‰è¨€ä¸å°‘Androidé¡¹ç›®ä¸­ï¼Œéƒ½ä½¿ç”¨äº†Text Warriorä½œä¸ºå®ƒä»¬çš„ä»£ç ç¼–è¾‘å™¨ã€‚è¿™ä¸ªé¡¹ç›®çš„è§†å›¾æ˜¯ç›´æ¥ç»§æ‰¿è‡ªViewçš„ï¼Œä¸é‚£äº›ç»§æ‰¿TextViewã€EditTextçš„é¡¹ç›®ä¸åŒã€‚ä½¿ç”¨TextViewï¼Œæˆ‘ä»¬è™½ç„¶èƒ½å¤Ÿè·å¾—è¾ƒä¸ºå‡ºè‰²çš„æ˜¾ç¤ºæ•ˆæœï¼Œä½†æ˜¯åœ¨æ–‡æœ¬è¾ƒé•¿çš„æ—¶å€™ï¼Œä¼šé€ æˆå¡é¡¿é˜»ç¢ç”¨æˆ·è¾“å…¥ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¾—ä¸åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°æˆ‘ä»¬çš„Spansï¼Œè€Œä¸”æ¯æ›´æ–°ä¸€ä¸ªSpanï¼Œéƒ½ä¼šå¯¼è‡´TextViewé‡ç»˜ã€‚è€Œä¸”ç»å¸¸å› ä¸ºæ­£åˆ™è¡¨">
<meta property="og:type" content="article">
<meta property="og:title" content="Text Warriorä¸­ä¸€äº›ä¸è¶³ä¹‹å¤„">
<meta property="og:url" content="https://blog.rosemoe.cyou/2020/08/24/what-is-slow-in-text-warrior/index.html">
<meta property="og:site_name" content="Rosemoeçš„å°åšå®¢">
<meta property="og:description" content="å‰è¨€ä¸å°‘Androidé¡¹ç›®ä¸­ï¼Œéƒ½ä½¿ç”¨äº†Text Warriorä½œä¸ºå®ƒä»¬çš„ä»£ç ç¼–è¾‘å™¨ã€‚è¿™ä¸ªé¡¹ç›®çš„è§†å›¾æ˜¯ç›´æ¥ç»§æ‰¿è‡ªViewçš„ï¼Œä¸é‚£äº›ç»§æ‰¿TextViewã€EditTextçš„é¡¹ç›®ä¸åŒã€‚ä½¿ç”¨TextViewï¼Œæˆ‘ä»¬è™½ç„¶èƒ½å¤Ÿè·å¾—è¾ƒä¸ºå‡ºè‰²çš„æ˜¾ç¤ºæ•ˆæœï¼Œä½†æ˜¯åœ¨æ–‡æœ¬è¾ƒé•¿çš„æ—¶å€™ï¼Œä¼šé€ æˆå¡é¡¿é˜»ç¢ç”¨æˆ·è¾“å…¥ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¾—ä¸åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°æˆ‘ä»¬çš„Spansï¼Œè€Œä¸”æ¯æ›´æ–°ä¸€ä¸ªSpanï¼Œéƒ½ä¼šå¯¼è‡´TextViewé‡ç»˜ã€‚è€Œä¸”ç»å¸¸å› ä¸ºæ­£åˆ™è¡¨">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.rosemoe.cyou/img/default_cover/16.jpg">
<meta property="article:published_time" content="2020-08-24T10:12:49.000Z">
<meta property="article:modified_time" content="2021-08-22T05:56:51.455Z">
<meta property="article:author" content="Rosemoe">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="CodeEditor">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.rosemoe.cyou/img/default_cover/16.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://blog.rosemoe.cyou/2020/08/24/what-is-slow-in-text-warrior/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Text Warriorä¸­ä¸€äº›ä¸è¶³ä¹‹å¤„',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-08-22 13:56:51',
  highlightLangExpand: 'null',
  highlightLangCollapse: 'cpp'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom_styles.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">5</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹æƒ…é“¾æ¥</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/default_cover/16.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Rosemoeçš„å°åšå®¢"><span class="site-name">Rosemoeçš„å°åšå®¢</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹æƒ…é“¾æ¥</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Text Warriorä¸­ä¸€äº›ä¸è¶³ä¹‹å¤„</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2020-08-24T10:12:49.000Z" title="å‘è¡¨äº 2020-08-24 18:12:49">2020-08-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2021-08-22T05:56:51.455Z" title="æ›´æ–°äº 2021-08-22 13:56:51">2021-08-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Android/">Android</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Text Warriorä¸­ä¸€äº›ä¸è¶³ä¹‹å¤„"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸å°‘Androidé¡¹ç›®ä¸­ï¼Œéƒ½ä½¿ç”¨äº†Text Warriorä½œä¸ºå®ƒä»¬çš„ä»£ç ç¼–è¾‘å™¨ã€‚è¿™ä¸ªé¡¹ç›®çš„è§†å›¾æ˜¯ç›´æ¥ç»§æ‰¿è‡ªViewçš„ï¼Œä¸é‚£äº›ç»§æ‰¿TextViewã€EditTextçš„é¡¹ç›®ä¸åŒã€‚ä½¿ç”¨TextViewï¼Œæˆ‘ä»¬è™½ç„¶èƒ½å¤Ÿè·å¾—è¾ƒä¸ºå‡ºè‰²çš„æ˜¾ç¤ºæ•ˆæœï¼Œä½†æ˜¯åœ¨æ–‡æœ¬è¾ƒé•¿çš„æ—¶å€™ï¼Œä¼šé€ æˆå¡é¡¿é˜»ç¢ç”¨æˆ·è¾“å…¥ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¾—ä¸åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°æˆ‘ä»¬çš„Spansï¼Œè€Œä¸”æ¯æ›´æ–°<em><strong>ä¸€ä¸ª</strong></em>Spanï¼Œéƒ½ä¼šå¯¼è‡´TextViewé‡ç»˜ã€‚è€Œä¸”ç»å¸¸å› ä¸ºæ­£åˆ™è¡¨è¾¾å¼ä¸å¤Ÿå‡†ç¡®è€Œå¯¼è‡´é«˜äº®å‡ºé”™ã€‚<br>TextWarrioråˆ™æ²¡æœ‰æ­¤é—®é¢˜ã€‚å®ƒæ”¶åˆ°æ–‡æœ¬æ›´æ–°çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨å…¶ä»–çº¿ç¨‹å¯åŠ¨Lexeræ¥åˆ·æ–°é«˜äº®ï¼Œåœ¨è¯¥çº¿ç¨‹ç»“æŸä¹‹ååˆ·æ–°ç»˜åˆ¶ï¼Œè¿™æ—¢ä¿è¯äº†é«˜äº®çš„æ­£ç¡®æ€§ï¼Œä¹Ÿä¿è¯äº†UIçº¿ç¨‹çš„æµç•…ã€‚ç„¶è€Œï¼Œå®ƒå…¶ä¸­æœ‰ä¸€äº›ä¸è¶³ä¹‹å¤„å¯¼è‡´å¤§æ–‡æœ¬ä»ç„¶ä¸èƒ½è¾ƒå¿«åœ°æ˜¾ç¤ºï¼Œä»¥åŠä¸€äº›ç”¨æˆ·ä½“éªŒçš„é—®é¢˜ã€‚   </p>
<h2 id="ç»˜åˆ¶é—®é¢˜"><a href="#ç»˜åˆ¶é—®é¢˜" class="headerlink" title="ç»˜åˆ¶é—®é¢˜"></a>ç»˜åˆ¶é—®é¢˜</h2><h3 id="SpanæŸ¥æ‰¾é—®é¢˜"><a href="#SpanæŸ¥æ‰¾é—®é¢˜" class="headerlink" title="SpanæŸ¥æ‰¾é—®é¢˜"></a>SpanæŸ¥æ‰¾é—®é¢˜</h3><p>TextWarriorçš„Spanæ˜¯ç”¨ArrayListï¼Œä¾ç…§é¡ºåºä¾æ¬¡å­˜èµ·æ¥çš„ï¼ŒSpanä¸­ä¿å­˜äº†å®ƒçš„Start Indexã€‚åˆ©ç”¨æœ‰åºçš„æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¿«åœ°åˆ©ç”¨äºŒåˆ†å°†ç‰¹å®šIndexå¯¹åº”çš„Spanæ‰¾å‡ºæ¥ã€‚å°¤å…¶æ˜¯åœ¨ç»˜åˆ¶æ—¶ï¼Œè¿™ååˆ†æœ‰ç”¨ï¼Œç›´æ¥å°†Oï¼ˆNï¼‰å¤æ‚çš„é™åˆ°Oï¼ˆlog Nï¼‰ï¼Œå¾ˆå¿«ã€‚ä½†æ˜¯ï¼Œç›®å‰åœ¨å„å¤„æµä¼ çš„ç‰ˆæœ¬éƒ½æ˜¯æŒ‰ç…§é¡ºåºå¯¹Spanè¿›è¡ŒæŸ¥æ‰¾çš„ï¼Œè¿™æ˜¯<code>realDraw()</code>ä¸­å…³äºæŸ¥æ‰¾çš„ä¸€æ®µä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="comment">// set up span coloring settings</span></span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="type">int</span> <span class="variable">spanIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">List&lt;Pair&gt; spans = mDoc.getSpans();</span><br><span class="line"></span><br><span class="line"><span class="comment">// There must be at least one span to paint, even for an empty file,</span></span><br><span class="line"><span class="comment">// where the span contains only the EOF character</span></span><br><span class="line">TextWarriorException.assertVerbose(!spans.isEmpty(),</span><br><span class="line">        <span class="string">&quot;No spans to paint in TextWarrior.paint()&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">Pair</span> <span class="variable">nextSpan</span> <span class="operator">=</span> (Pair) spans.get(spanIndex++);</span><br><span class="line">Pair currSpan;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    currSpan = nextSpan;</span><br><span class="line">    <span class="keyword">if</span> (spanIndex &lt; spans.size()) &#123;</span><br><span class="line">        nextSpan = (Pair) spans.get(spanIndex++);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        nextSpan = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (nextSpan != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">        nextSpan.getFirst() &lt;= currentIndex);</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œå®ƒç”¨äº†é¡ºåºæŸ¥æ‰¾ï¼Œæ£€æŸ¥Spançš„Indexæœ‰æ²¡æœ‰è¾¾åˆ°èµ·å§‹ç»˜åˆ¶çš„Indexã€‚<br>è¿™åœ¨æ˜¾ç¤ºå¤§æ–‡æœ¬çš„åç«¯çš„æ—¶å€™ï¼Œä¼šé€ æˆå¡é¡¿ã€‚<br>è§£å†³åŠæ³•æ˜¯ç”¨Binary Searchã€‚</p>
<h3 id="ç»˜åˆ¶æäº¤é—®é¢˜"><a href="#ç»˜åˆ¶æäº¤é—®é¢˜" class="headerlink" title="ç»˜åˆ¶æäº¤é—®é¢˜"></a>ç»˜åˆ¶æäº¤é—®é¢˜</h3><p>TextWarrioré™¤äº†åœ¨æŸ¥æ‰¾Spanæœ‰æ€§èƒ½éšœç¢æ„å¤–,ç»˜åˆ¶ä¹Ÿæœ‰é—®é¢˜.<br>å…ˆæ¥åˆ†æä¸€ä¸‹ä¸‹é¢è¿™ä¸ªä»£ç å•Š:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">       <span class="comment">//----------------------------------------------</span></span><br><span class="line">    <span class="comment">// start painting!</span></span><br><span class="line">    <span class="comment">//----------------------------------------------</span></span><br><span class="line">    _hDoc.seekChar(currentIndex);</span><br><span class="line">    <span class="keyword">while</span> (paintY &lt;= endY &amp;&amp; _hDoc.hasNext())&#123;</span><br><span class="line">         <span class="comment">// check if formatting changes are needed</span></span><br><span class="line">         <span class="keyword">if</span> (reachedNextSpan(currentIndex, nextSpan))&#123;</span><br><span class="line">             currSpan = nextSpan;</span><br><span class="line">             spanColor = ColorScheme.getTokenColor(currSpan.getSecond());</span><br><span class="line">             _brush.setColor(spanColor);</span><br><span class="line"></span><br><span class="line">             <span class="keyword">if</span>(spanIndex &lt; spans.size())&#123;</span><br><span class="line">                 nextSpan = (Pair) spans.get(spanIndex++);</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">else</span>&#123;</span><br><span class="line">                 nextSpan = <span class="literal">null</span>;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> _hDoc.next();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (currentIndex == _caretPosition)&#123;</span><br><span class="line">            paintX += drawCaret(canvas, c, paintX, paintY);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (_fieldController.inSelectionRange(currentIndex))&#123;</span><br><span class="line">            paintX += drawSelectedText(canvas, c, paintX, paintY);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            paintX += drawChar(canvas, c, paintX, paintY);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">         ++currentIndex;</span><br><span class="line">         <span class="keyword">if</span> (c == LanguageCFamily.NEWLINE)&#123;</span><br><span class="line">      		paintY += rowHeight();</span><br><span class="line">             <span class="keyword">if</span> (paintX &gt; _xExtent)&#123;</span><br><span class="line">                 _xExtent = paintX;</span><br><span class="line">             &#125;</span><br><span class="line">      		paintX = <span class="number">0</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125; <span class="comment">// end while</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> (paintX &gt; _xExtent)&#123;</span><br><span class="line">            <span class="comment">// record widest line seen so far</span></span><br><span class="line">            _xExtent = paintX;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¸€çœ‹è¿™ä¸ªç»˜åˆ¶,è¿˜è¡Œå§,æ¸¸æ ‡ä»€ä¹ˆçš„çš„ç»˜åˆ¶éƒ½åˆå¹¶åˆ°ä¸€èµ·å»äº†,æ¢è¡Œçš„æ—¶å€™æ‰æ›´æ–°baseline,èŠ‚çº¦äº†ä¸å°‘æµ‹é‡æäº¤å•Š,ä¸é”™ä¸é”™.<br>ä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°,å®ƒæ˜¯<em><strong>ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦ç»˜åˆ¶çš„</strong></em>!!!<br>æˆ‘ä»¬å†çœ‹çœ‹<code>drawChar</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">drawChar</span><span class="params">(Canvas canvas, <span class="type">char</span> c, <span class="type">int</span> paintX, <span class="type">int</span> paintY)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(c != LanguageCFamily.NEWLINE &amp;&amp;</span><br><span class="line">            c != LanguageCFamily.EOF &amp;&amp;</span><br><span class="line">            c != LanguageCFamily.TAB)&#123;</span><br><span class="line">            <span class="type">char</span>[] ca = &#123;c&#125;;</span><br><span class="line">         canvas.drawText(ca, <span class="number">0</span>, <span class="number">1</span>, paintX, paintY, _brush);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> getAdvance(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘:???<br>æˆ‘ä»¬çœ‹åˆ°,æ¯ç»˜åˆ¶ä¸€ä¸ªå­—ç¬¦,éƒ½åˆ›å»ºä¸€ä¸ªchar[].å¥½å…„å¼Ÿä½ å°±ä¸èƒ½æŠŠå®ƒç¼“å­˜èµ·æ¥å—!!!ç»˜åˆ¶çš„æ—¶å€™è¦å°¤å…¶æ³¨æ„,å°½é‡å°‘åˆ›å»ºæ–°å¯¹è±¡,è¿™ä¼šæ‹–æ…¢ç»˜åˆ¶çš„é€Ÿåº¦.<br>è¿˜æœ‰ä¸€ä¸ªä»€ä¹ˆé—®é¢˜? å—¯,è™½ç„¶åœ¨Javaä¸­,ä¸€ä¸ªcharèƒ½è¡¨ç¤ºçš„å­—ç¬¦æœ‰å¾ˆå¤š,ä½†æ˜¯ä¹Ÿä¸æ˜¯å…¨éƒ¨éƒ½èƒ½è¡¨ç¤º.ä¸èƒ½å°±ä¸èƒ½å§,é‚£äº›ä¸èƒ½ä¸€ä¸ªcharè¡¨ç¤ºçš„å­—ç¬¦ç”¨çš„ä¹Ÿä¸å¤š.ä½†æ˜¯æˆ‘ä»¬æœ‰ä¸€ä¸ªå¾ˆå¸¸è§çš„ç¬¦å·è¡¨:emoji!<br>Emojiéƒ½æ˜¯ä¸¤ä¸ªcharç»„æˆçš„! è¿™å°±ä¼šå¯¼è‡´åœ¨ç»˜åˆ¶ä¸­,emojiä¼šå˜æˆä¸€ä¸ªè±å½¢åŒ…è£¹çš„â€™?â€™<br>å†çœ‹çœ‹<code>getAdvance()</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">getAdvance</span><span class="params">(<span class="type">char</span> c)</span>&#123;</span><br><span class="line">    <span class="type">int</span> advance;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span> (c)&#123;</span><br><span class="line">        <span class="keyword">case</span> LanguageCFamily.NEWLINE: <span class="comment">// fall-through</span></span><br><span class="line">        <span class="keyword">case</span> LanguageCFamily.EOF:</span><br><span class="line">            advance = getEmptyAdvance();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LanguageCFamily.TAB:</span><br><span class="line">            advance = getTabAdvance();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="type">char</span>[] ca = &#123;c&#125;;</span><br><span class="line">            advance = (<span class="type">int</span>) _brush.measureText(ca, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">break</span>;	</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> advance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">getEmptyAdvance</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">int</span>) (EMPTY_CARET_WIDTH_SCALE * _brush.measureText(<span class="string">&quot; &quot;</span>, <span class="number">0</span>, <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">getTabAdvance</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _tabLength * (<span class="type">int</span>) _brush.measureText(<span class="string">&quot; &quot;</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å—¯,å’Œ<code>drawChar()</code>å·®ä¸å¤šçš„åŸç†. ä½†æ˜¯æˆ‘ä»¬å‘ç°,è¿™äº›<code>getAdvance()</code>,è¿”å›ç±»å‹éƒ½æ˜¯int!<br>è¿™ä¼šå¯¼è‡´åœ¨ä½DPIè®¾å¤‡ä¸Šå­—ä½“è¾ƒå°æ—¶,ç©ºæ ¼å’Œtabæ— æ³•æ­£å¸¸æ˜¾ç¤º(advance &#x3D; 0),æ‰€æœ‰çš„å­—ç¬¦çœ‹èµ·æ¥éƒ½æ˜¯è¿åœ¨ä¸€èµ·çš„.<br>æ­¤å¤–,ä¸€ä¸ªä¸€ä¸ªcharç»˜åˆ¶,éœ€è¦æäº¤çš„measure&#x2F;drawçš„æ¬¡æ•°è¾ƒå¤š,åœ¨nativeä¼¼ä¹æ²¡æœ‰å¯¹å­—ç¬¦å®½åº¦è¿›è¡Œç¼“å­˜.<br>è€Œä¸”,è¿™æ ·é¢‘ç¹æäº¤measure&#x2F;drawä¼šæ¶ˆè€—å¾ˆå¤šæ—¶é—´,ä»è€Œé€ æˆå¡é¡¿.<br>æˆ‘å»ºè®®çš„æ–¹å¼æŒ‰è¡Œç»˜åˆ¶,ç„¶åä¾ç…§è¡Œé‡Œé¢çš„Spansè¿›è¡ŒåŒºé—´ç»˜åˆ¶,å¯ä»¥å‡å°‘è¿™ä¸€æŸè€—.<br>æ­¤å¤–,é’ˆå¯¹å­—ç¬¦measureçš„ç»“æœå¯ä»¥ä½¿ç”¨SparseIntArrayæˆ–è€…ç›´æ¥å¼€float[]ä¿å­˜èµ·æ¥,è¿™æ ·å®æµ‹æ¯”æ€»æ˜¯å‘nativeæäº¤measureå¿«å¤§çº¦10å€<br>å¦‚ä¸‹å›¾æ‰€ç¤º:<br><img src="/img/posts/what-is-slow-in-text-warrior/1.png" alt="Code"><br><img src="/img/posts/what-is-slow-in-text-warrior/2.png" alt="Result"><br>è¯»å…¥çš„æ–‡ä»¶æ˜¯æˆ‘çš„CodeEditor.java,é•¿è¾¾118KB,æˆ‘å°†å›è½¦åˆ å»äº†åªæœ‰ä¸€è¡Œ.<br>åœ¨ç›´æ¥å°†æ•´ä¸ªæ–‡ä»¶å†…å®¹ç»™nativeæµ‹é‡,10æ¬¡èŠ±è´¹äº†9157ms.è€Œä½¿ç”¨SparseIntArrayç¼“å­˜å­—ç¬¦å¤§å°,10æ¬¡åªç”¨äº†979ms,å¯è§å·®è·æœ‰å¤šå¤§.<br>ä¹Ÿå‘Šè¯‰æˆ‘ä»¬ä¸æ˜¯æ‰€æœ‰çš„æ“ä½œåœ¨nativeå°±æ›´å¿«äº†,æ¯”å¦‚åƒè¿™æ ·çš„å­—ç¬¦æµ‹é‡,åœ¨nativeå¾ˆæœ‰å¯èƒ½æ²¡æœ‰ç¼“å­˜,æ¯æ¬¡é‡åˆ°ä¹‹å‰é‡åˆ°çš„å­—ç¬¦ä¹Ÿè¦å’Œä¹‹å‰ä¸€æ ·å¤„ç†,ä»è€Œå¯¼è‡´é€Ÿåº¦é™ä½.ä¹Ÿå½±å“äº†æˆ‘ä»¬çš„ç»˜åˆ¶è¿‡ç¨‹.<br>è¿™é‡Œè¿˜æœ‰ä¸€å¼ åŒºå—ç»˜åˆ¶ä¸é€å­—ç¬¦ç»˜åˆ¶çš„å¯¹æ¯”å›¾:<br><img src="/img/posts/what-is-slow-in-text-warrior/3.png" alt="Compare"><br>å¯è§å…¶é€Ÿåº¦å·®å¼‚.<br>æ­¤å¤–æˆ‘ä»¬è¿˜å‘ç°ä¸€ä¸ªé—®é¢˜:åªè¦è¿™ä¸€è¡Œæ˜¯å¯è§çš„, é‚£ä¹ˆè¿™ä¸€è¡Œçš„æ‰€æœ‰å­—ç¬¦éƒ½ä¼šè¢«æäº¤ç»˜åˆ¶!æ— è®ºè¿™ä¸ªå­—ç¬¦åœ¨è¿™ä¸€è¡Œä¸Šæ˜¯å¦å¯¹ç”¨æˆ·æ˜¯å¯è§çš„,éƒ½ä¼šè¢«ç»˜åˆ¶! è¿™åˆæ˜¯ä¸€ä¸ªæ€§èƒ½é—®é¢˜. å¦‚æœè¯´è¿™æ˜¯ä¸ºäº†åé¢æ›´æ–°æœ€å¤§æ¨ªå‘ç»˜åˆ¶ä½ç½®çš„è¯,æˆ‘ä»¬å®Œå…¨å¯ä»¥ç”¨ä¸€æ¬¡measureTextå®Œæˆ,è‡³å°‘å‰éƒ¨çš„ä¸å¯è§éƒ¨åˆ†æ˜¯ä¸ç”¨ç»˜åˆ¶çš„.</p>
<h2 id="ç”¨æˆ·ä½“éªŒé—®é¢˜"><a href="#ç”¨æˆ·ä½“éªŒé—®é¢˜" class="headerlink" title="ç”¨æˆ·ä½“éªŒé—®é¢˜"></a>ç”¨æˆ·ä½“éªŒé—®é¢˜</h2><h3 id="é«˜äº®éæ³•æ—¶çš„æ˜¾ç¤ºé—®é¢˜"><a href="#é«˜äº®éæ³•æ—¶çš„æ˜¾ç¤ºé—®é¢˜" class="headerlink" title="é«˜äº®éæ³•æ—¶çš„æ˜¾ç¤ºé—®é¢˜"></a>é«˜äº®éæ³•æ—¶çš„æ˜¾ç¤ºé—®é¢˜</h3><p>TextWarrioråœ¨æ–‡æœ¬ç¼–è¾‘ä¹‹å,é«˜äº®è¿˜æ²¡æœ‰åˆ†æå®Œæ¯•æ—¶,ç»˜åˆ¶å‡ºçš„é«˜äº®ç”±äºSpansæ²¡æœ‰è¢«ç»´æŠ¤,ä¼šå¯¼è‡´é«˜äº®åŒºåŸŸé”™ä¹±.<br>è¦å‘½çš„æ˜¯,æœ‰çš„æ—¶å€™ä½ èƒ½è§‚å¯Ÿåˆ°æ˜æ˜¾çš„æ–‡æœ¬é—ªçƒç°è±¡,ä¹Ÿæ˜¯Spansæ²¡æœ‰è¢«ç»´æŠ¤é€ æˆçš„.<br>è€Œä¸”è‹¥è¦æŒ‰ç›®å‰çš„æ–¹æ¡ˆå®ç°è¿™ä¸€ç»´æŠ¤,ä¹Ÿæ˜¯æ¶ˆè€—æ€§èƒ½çš„,å¯èƒ½å¯¼è‡´æ–‡æœ¬è¾“å…¥å¡é¡¿.å› ä¸ºè¾“å…¥&#x2F;åˆ é™¤ä¸€ä¸ªå­—ç¬¦æ„å‘³ç€åé¢æ‰€æœ‰çš„Spansçš„Indexéƒ½å¿…é¡»è¢«æ›´æ–°,æ‰èƒ½è¾¾åˆ°ç»´æŠ¤çš„ç›®çš„.è¿™åœ¨Spanè¾ƒå¤šæ—¶ä¼šè€—è´¹è¾ƒå¤šæ—¶é—´.<br>åœ¨è¿™ä¸€ç‚¹ä¸Šåšå‡ºæ”¹è¿›çš„<a target="_blank" rel="noopener" href="https://github.com/nirenr/AndroLua_pro/">AndroLua+</a>çš„æ–¹æ¡ˆå¯ä»¥å‡å°‘æŸè€—,å®ƒSpanä¸­ä¿å­˜çš„ä¸æ˜¯Start Indexè€Œæ˜¯Length,ä»è€Œèƒ½åœ¨è¾ƒå°‘æ—¶é—´å†…ç»´æŠ¤å¥½Spançš„èŒƒå›´.é—æ†¾çš„æ˜¯è¿™ä¸èƒ½ä½¿ç”¨äºŒåˆ†è¿›è¡ŒåŠ é€Ÿå¤„ç†,æŸ¥æ‰¾Spanä¾ç„¶éœ€è¦æ—¶é—´.</p>
<h3 id="æ¨ªå‘æ»šåŠ¨æœ€å¤§å€¼"><a href="#æ¨ªå‘æ»šåŠ¨æœ€å¤§å€¼" class="headerlink" title="æ¨ªå‘æ»šåŠ¨æœ€å¤§å€¼"></a>æ¨ªå‘æ»šåŠ¨æœ€å¤§å€¼</h3><p>å‰é¢æåˆ°TextWarriorä¼šæ›´æ–°æ¨ªå‘ç»˜åˆ¶çš„æœ€å¤§å€¼,åŸå› åœ¨äºå®ƒä½¿ç”¨è¿™ä¸ªå€¼æ¥ç¡®å®šæœ€å¤§æ¨ªå‘æ»‘åŠ¨ä½ç½®.å¦‚æœæœ‰æ›´é•¿çš„è¡Œ,å®ƒè¿˜æ²¡æœ‰è¢«æ»‘åŠ¨åˆ°,é‚£ä¹ˆæ­¤æ—¶çš„æœ€å¤§æ¨ªå‘æ»‘åŠ¨ä½ç½®æ˜¯æ— æ³•è®©é‚£ä¸€è¡Œæ˜¾ç¤ºå…¨çš„.è€Œç”¨æˆ·åœ¨æ»‘åŠ¨è¿‡ç¨‹ä¸­,ç”±äºæƒ¯æ€§æ»‘åŠ¨,çªç„¶æ¨ªå‘æœ€å¤§è·ç¦»å‘ç”Ÿäº†å¢å¤§,é‚£ä¹ˆæƒ¯æ€§æ»‘åŠ¨å¾ˆå¯èƒ½å°±å¯¼è‡´è§†å›¾åç§»è¿‡å»äº†. è€Œä¸”,åœ¨æœ€é•¿è¡Œå˜çŸ­ä¹‹å,ç³Ÿç³•çš„äº‹æƒ…å‘ç”Ÿäº†:æœ€å¤§å€¼ä¸ä¼šæ›´æ–°,å¯¼è‡´è¿‡åº¦çš„æ¨ªå‘æ»‘åŠ¨å¯ä»¥äº§ç”Ÿ,å¦‚æœæ”¹åŠ¨è¾ƒå¤§,é‚£ä¹ˆç”¨æˆ·ç”šè‡³å¯ä»¥çœ‹åˆ°ä¸€å †ç™½å±.</p>
<h3 id="è¾“å…¥æ³•ä¿¡æ¯"><a href="#è¾“å…¥æ³•ä¿¡æ¯" class="headerlink" title="è¾“å…¥æ³•ä¿¡æ¯"></a>è¾“å…¥æ³•ä¿¡æ¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//*********************************************************************</span></span><br><span class="line">    <span class="comment">//************************** InputConnection **************************</span></span><br><span class="line">    <span class="comment">//*********************************************************************</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Does not provide ExtractedText related methods</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">TextFieldInputConnection</span> <span class="keyword">extends</span> <span class="title class_">BaseInputConnection</span>&#123;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°ä¸€å¥ä»€ä¹ˆè¯? â€œä¸æä¾›æå–æ–‡æœ¬ç›¸å…³çš„æ–¹æ³•â€<br>å’±ä»¬ç”¨èµ·è¿™ä¸ªç¼–è¾‘å™¨æ¥æ„Ÿè§‰å¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜.ç„¶è€Œ,è¾“å…¥ç¬¦å·å¯¹çš„æ—¶å€™,æˆ‘ä»¬æƒŠè®¶åœ°å‘ç°,æ¸¸æ ‡è‡ªåŠ¨è·‘åˆ°æœ€å‰é¢äº†!<br>åŸæ¥,è¾“å…¥æ³•ä¾èµ–<code>getExtractedText</code>ä¸»åŠ¨è·å–å…‰æ ‡åœ¨æ–‡ä¸­çš„ä½ç½®,ç„¶åå†é€šè¿‡<code>setSelection</code>è®¾ç½®æ¸¸æ ‡.å¦‚æœä¸å®ç°è¿™ä¸ªæ–¹æ³•,é‚£ä¹ˆè¾“å…¥æ³•å°±ä¼šè®¤ä¸ºæ–‡æœ¬é•¿åº¦ä¸º0è€Œé€šè¿‡<code>setSelection</code>æŠŠå…‰æ ‡è®¾å®šåˆ°0äº†!<br>åŒæ—¶<code>æœç‹—è¾“å…¥æ³•</code>åœ¨å‘ç¼–è¾‘å™¨å‘é€<code>KeyEvent</code>çš„<code>KEYCODE_DPAD_LEFT</code>æˆ–è€…<code>KEYCODE_DPAD_RIGHT</code>ä¹‹å‰ä¼šå…ˆé€šè¿‡<code>getExtractedText</code>æ¥è·å¾—ç¼–è¾‘å™¨ä¸­çš„æ–‡æœ¬,ä»¥ç¡®å®šæ˜¯å¦å¯ä»¥å‘å·¦&#x2F;å‘å³ç§»åŠ¨å…‰æ ‡,å¦‚æœä¸èƒ½,é‚£ä¹ˆå®ƒä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œ.<br>å¦å¤–,å¦‚æœä½¿ç”¨è¿‡å¤§å±å¹•è®¾å¤‡çš„ç”¨æˆ·å¯èƒ½ä¼šå‘ç°,å¯ç”¨åƒç”µè„‘ä¸Šä¸€æ ·ä¼šè·Ÿéšçš„è¾“å…¥æ³•æ¡,TextWarriorä¼šè®©å®ƒâ€ä¸çŸ¥é“è·‘åˆ°å“ªé‡Œå»â€.åŸå› æ˜¯ç¼–è¾‘å™¨æ²¡æœ‰è°ƒç”¨<code>InputMethodManager</code>çš„<code>updateCursor</code>æˆ–è€…<code>updateCursorAnchor</code>æ¥æ›´æ–°æ¸¸æ ‡åœ¨åº”ç”¨çª—å£ä¸­çš„ä½ç½®.    </p>
<h2 id="é«˜äº®åˆ†æé—®é¢˜"><a href="#é«˜äº®åˆ†æé—®é¢˜" class="headerlink" title="é«˜äº®åˆ†æé—®é¢˜"></a>é«˜äº®åˆ†æé—®é¢˜</h2><p>ä¸Šé¢å·²ç»è¯´è¿‡,TextWarriorä¼šåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­åˆ†æé«˜äº®.æ–‡æœ¬æ›´æ–°çš„æ—¶å€™,<code>FreeScrollingTextField</code>è°ƒç”¨<code>Lexer#tokenize()</code>æ¥å¼‚æ­¥è¿è¡Œlexer. ä¸¥æ ¼æ¥è¯´,è¿™å·²ç»ä¸å±äºTextWarrioræœ¬èº«çš„é—®é¢˜,è€Œå±äºåç»­ä¿®æ”¹è€…çš„é—®é¢˜. æˆ‘ä»¬ç»å¸¸ä½¿ç”¨ JFlex æ¥æ„å»ºè¯æ³•åˆ†æå™¨,è¿™äº›ä¿®æ”¹è€…å¹¶æ²¡æœ‰åšå¾—å¾ˆå¥½. åœ¨åŸTextWarriorä¸­,è¯æ³•åˆ†æçš„å¾ªç¯æ˜¯è¿™ä¹ˆå†™çš„:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (hDoc.hasNext() &amp;&amp; !_abort.isSet())&#123;</span><br></pre></td></tr></table></figure>
<p>_abortæ­£æ˜¯<code>tokenize</code>å‘ç°çº¿ç¨‹æ­£åœ¨è¿è¡Œçš„æ—¶å€™è®¾ç«‹çš„åœæ­¢flag, è¿™äº›JFlexä½¿ç”¨è€…ä»¬å¹¶æ²¡æœ‰åˆ©ç”¨åˆ°è¿™ä¸€flagæ¥åŠæ—¶åœæ­¢æ“ä½œ,ä»è€Œå¯¼è‡´æ—¶é—´ä¸Šçš„æµªè´¹.åœ¨åˆ†æç¨å¤§æ–‡æœ¬æ—¶,æ—¶é—´æµªè´¹å°¤å…¶æ˜æ˜¾.<br>TextWarrioråŸç‰ˆä¹Ÿæœ‰é—®é¢˜:å­˜å‚¨Spansæ²¡æœ‰ç”¨<code>ArrayList</code>,è€Œæ˜¯ä½¿ç”¨çš„å„ç§æ–¹æ³•éƒ½ç”¨<code>synchronized</code>æ ‡æ³¨çš„<code>Vector</code>,è€Œtokensæ˜¯åªè¢«å•ä¸ªçº¿ç¨‹æ“ä½œçš„,æ²¡æœ‰å¿…è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ç±»,å¯¼è‡´æ€§èƒ½ä¸‹é™.</p>
<h2 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><p>TextWarriorä¸­ä¹Ÿæœ‰ä¸€äº›æºç ä¸Šçš„å‘½åå¾ˆæ€ª,æ¯”å¦‚<code>Yoyo</code>,ä¸€å¼€å§‹è§åˆ°å®ƒçš„æ—¶å€™ä¸çŸ¥é“æ˜¯ä»€ä¹ˆä¸œè¥¿,ä»”ç»†ä¸€çœ‹æ‰çŸ¥é“æ˜¯é€‰æ‹©æ‰‹æŸ„.   </p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://blog.rosemoe.cyou">Rosemoe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://blog.rosemoe.cyou/2020/08/24/what-is-slow-in-text-warrior/">https://blog.rosemoe.cyou/2020/08/24/what-is-slow-in-text-warrior/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://blog.rosemoe.cyou" target="_blank">Rosemoeçš„å°åšå®¢</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android</a><a class="post-meta__tags" href="/tags/CodeEditor/">CodeEditor</a></div><div class="post_share"><div class="social-share" data-image="/img/default_cover/16.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/10/30/image-to-qq-painting/" title="ğŸ‘´ç©çˆ†QQæ¶‚é¸¦"><img class="cover" src="/img/default_cover/4.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">ğŸ‘´ç©çˆ†QQæ¶‚é¸¦</div></div></a></div><div class="next-post pull-right"><a href="/2020/04/25/android-dev-mistake/" title="è®°Androidå¼€å‘ä¸­ä¸€ä¸ªå‘ - ViewRootImpl"><img class="cover" src="/img/post_cover_android_mistake.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">è®°Androidå¼€å‘ä¸­ä¸€ä¸ªå‘ - ViewRootImpl</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Rosemoe</div><div class="author-info__description">A lazy Android developer</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Rosemoe"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Rosemoe" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="javascript:copyEmail();" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æ¬¢è¿æ¥åˆ°Rosemoeçš„å°åšå®¢~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E9%97%AE%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">ç»˜åˆ¶é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Span%E6%9F%A5%E6%89%BE%E9%97%AE%E9%A2%98"><span class="toc-number">2.1.</span> <span class="toc-text">SpanæŸ¥æ‰¾é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E6%8F%90%E4%BA%A4%E9%97%AE%E9%A2%98"><span class="toc-number">2.2.</span> <span class="toc-text">ç»˜åˆ¶æäº¤é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C%E9%97%AE%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">ç”¨æˆ·ä½“éªŒé—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E4%BA%AE%E9%9D%9E%E6%B3%95%E6%97%B6%E7%9A%84%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98"><span class="toc-number">3.1.</span> <span class="toc-text">é«˜äº®éæ³•æ—¶çš„æ˜¾ç¤ºé—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%AA%E5%90%91%E6%BB%9A%E5%8A%A8%E6%9C%80%E5%A4%A7%E5%80%BC"><span class="toc-number">3.2.</span> <span class="toc-text">æ¨ªå‘æ»šåŠ¨æœ€å¤§å€¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E6%B3%95%E4%BF%A1%E6%81%AF"><span class="toc-number">3.3.</span> <span class="toc-text">è¾“å…¥æ³•ä¿¡æ¯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E4%BA%AE%E5%88%86%E6%9E%90%E9%97%AE%E9%A2%98"><span class="toc-number">4.</span> <span class="toc-text">é«˜äº®åˆ†æé—®é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E5%AE%83"><span class="toc-number">5.</span> <span class="toc-text">å…¶å®ƒ</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/08/09/codeforces-hacks-on-unordered-map/" title="Codeforcesæ¯”èµ›ä¸­çš„unordered_map Hacks"><img src="/img/default_cover/13.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Codeforcesæ¯”èµ›ä¸­çš„unordered_map Hacks"/></a><div class="content"><a class="title" href="/2023/08/09/codeforces-hacks-on-unordered-map/" title="Codeforcesæ¯”èµ›ä¸­çš„unordered_map Hacks">Codeforcesæ¯”èµ›ä¸­çš„unordered_map Hacks</a><time datetime="2023-08-08T16:45:04.000Z" title="å‘è¡¨äº 2023-08-09 00:45:04">2023-08-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/26/codeforces-888/" title="Codeforces Round 888 (Div.3) A-G é¢˜è§£"><img src="/img/default_cover/15.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Codeforces Round 888 (Div.3) A-G é¢˜è§£"/></a><div class="content"><a class="title" href="/2023/07/26/codeforces-888/" title="Codeforces Round 888 (Div.3) A-G é¢˜è§£">Codeforces Round 888 (Div.3) A-G é¢˜è§£</a><time datetime="2023-07-26T07:05:22.000Z" title="å‘è¡¨äº 2023-07-26 15:05:22">2023-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/24/atcoder-abc311/" title="AtCoder Beginner Contest 311 A-E é¢˜è§£"><img src="/img/default_cover/19.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AtCoder Beginner Contest 311 A-E é¢˜è§£"/></a><div class="content"><a class="title" href="/2023/07/24/atcoder-abc311/" title="AtCoder Beginner Contest 311 A-E é¢˜è§£">AtCoder Beginner Contest 311 A-E é¢˜è§£</a><time datetime="2023-07-24T07:23:33.000Z" title="å‘è¡¨äº 2023-07-24 15:23:33">2023-07-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/23/atcoder-abc310/" title="AtCoder Beginner Contest 310 A-F é¢˜è§£"><img src="/img/default_cover/11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AtCoder Beginner Contest 310 A-F é¢˜è§£"/></a><div class="content"><a class="title" href="/2023/07/23/atcoder-abc310/" title="AtCoder Beginner Contest 310 A-F é¢˜è§£">AtCoder Beginner Contest 310 A-F é¢˜è§£</a><time datetime="2023-07-23T13:34:35.000Z" title="å‘è¡¨äº 2023-07-23 21:34:35">2023-07-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/24/whut-2022-autumn-c-answer/" title="WHUT2022ç§‹Cè¯­è¨€Aç±»ç­”æ¡ˆ"><img src="/img/default_cover/9.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WHUT2022ç§‹Cè¯­è¨€Aç±»ç­”æ¡ˆ"/></a><div class="content"><a class="title" href="/2022/10/24/whut-2022-autumn-c-answer/" title="WHUT2022ç§‹Cè¯­è¨€Aç±»ç­”æ¡ˆ">WHUT2022ç§‹Cè¯­è¨€Aç±»ç­”æ¡ˆ</a><time datetime="2022-10-24T09:45:05.000Z" title="å‘è¡¨äº 2022-10-24 17:45:05">2022-10-24</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Rosemoe</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">ã«ã‚ƒã‚“~</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script async src="/js/sideloaded.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="ã«ã‚ƒã‚“~,å–µ~" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>